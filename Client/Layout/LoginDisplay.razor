@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inject NavigationManager Navigation

<AuthorizeView>
    <Authorized>
        <MudHidden Breakpoint="Breakpoint.Xs">
            <MudText Typo="Typo.subtitle2">@CalculateDisplayName(context)</MudText>
        </MudHidden>
        <MudButton Class="ma-4" Variant="Variant.Outlined" Color="Color.Secondary" OnClick="BeginLogOut">Log out</MudButton>
    </Authorized>
    <NotAuthorized>
        <MudLink Class="ma-4" Typo="Typo.subtitle1" Color="Color.Secondary" href="authentication/login">Log in</MudLink>
    </NotAuthorized>
</AuthorizeView>

@code {
    private string CalculateDisplayName(AuthenticationState authState)
    {
        string fullName = authState.User.Identity?.Name ?? "Guest";
        if (fullName.Length < 16)
        {
            return $"Hello, {fullName}!";
        }

        int emailEnd = fullName.IndexOf("@");
        if (0 < emailEnd && emailEnd <= 16)
        {
            return $"Hello, {fullName.Substring(0, emailEnd)}!";
        }

        return $"Hello, {fullName.Substring(0, 16)}!";
    }

    private void BeginLogOut()
    {
        Navigation.NavigateToLogout("authentication/logout");
    }
}
