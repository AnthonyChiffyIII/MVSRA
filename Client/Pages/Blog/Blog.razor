@page "/blog"

@using BlazingApple.Components.HTMLElements
@using BlazingApple.Components.Shared.Models.Reactions;
@using BlazingApple.Components;
@using BlazingApple.Forums.Components.Posts
@using BlazingApple.Forums.Components.Communities
@using BlazingApple.Forums.Shared.Models.Votes;
@using BlazingApple.Forums.Shared.Models.Base;
@using BlazingApple.Forums.Shared.Models.Communities;
@using BlazingApple.Forums.Shared.Models.Posts;
@using Microsoft.AspNetCore.Components;

<BlazingAppleProvider>
    @if (_community is not null)
    {
        <CommunityDetails Community="_community" Posts="_community.Posts" VoteStyle="_voteStyle">
            <p>This is a community page. This shows a collection of posts, the community's members, and the option to join or create a new post in the community.</p>
            <p>
                Options:
                <div>
                    <label>Voting style</label>
                    <PillRadioGroup AdditionalClasses="small" Name="voteStyle" @bind-Value="_voteStyle" Options="@(Enum.GetValues<VoteStyle>())">
                        <TemplatedContent Context="voteStyle">@voteStyle.GetEnumDisplayName()</TemplatedContent>
                    </PillRadioGroup>
                </div>
            </p>
        </CommunityDetails>
    }
</BlazingAppleProvider>

@code {
    private IForumCommunity? _community;
    private VoteStyle _voteStyle = VoteStyle.ReactionsOnly;

    [Parameter, EditorRequired]
    public string Slug { get; set; } = null!;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        _community = new ForumCommunity()
            {
                Title = "Blazing Heat",
                Slug = Slug,
                DatabaseCreationTimestamp = DateTime.UtcNow.AddDays(Random.Shared.Next(0, 1000)),
                CreatingUserId = "abc",
                Description = "All about hot sauce",
                ForumId = Guid.NewGuid(),
                Posts = new List<IPost>()
            };

        _community.Posts!.Add(GetPost("Best Sauces from Each Country", "I love them all"));
        _community.Posts!.Add(GetPost("Best Sauces from Each City", "Louisiana does it best"));
        _community.Posts!.Add(GetPost("How to recover your tongue from a sauce burn", "hot hot hot"));
    }

    private IPost GetPost(string title, string content)
    {
        string slug = Convert.ToBase64String(Guid.NewGuid().ToByteArray());

        return new Post()
            {
                Id = Guid.NewGuid(),
                Slug = slug,
                Title = title,
                Content = content,
                UserId = "abc",
                Reactions = Posts.GetReactions(),
            };
    }
}